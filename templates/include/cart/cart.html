{% extends "base.html" %}

{% block content %}
<div class="fixed inset-0 top-5 left-2 w-full max-h-screen mb-20 z-50">
    <div class="bg-white bg-opacity-10 backdrop-blur-lg shadow-lg w-full md:w-4/5 lg:w-2/3 xl:w-2/3 p-6 transform translate-y-16 transition-transform duration-300 rounded-lg z-50">
        <button 
            class="absolute top-4 right-4 text-gray-300 hover:text-white z-70" 
            onclick="window.location.href='/'">
            <i class="fi fi-rr-cross-circle text-4xl"></i>
        </button>

        <!-- Cart Details and Summary -->
        <div class="mt-12 flex flex-col lg:flex-row gap-6">
            <!-- Cart Items -->
            <div class="w-full lg:w-3/5 space-y-6 max-h-[calc(100vh-10rem)] cart-items">
                {% for item in cart_items %}
                <div class="flex items-center justify-between border border-gray-300 rounded-lg p-4 shadow-md bg-white bg-opacity-20 backdrop-blur-lg">
                    <img src="{{ item.image_url }}" alt="{{ item.name }}" class="w-24 h-24 object-cover rounded-md" />
                    <div class="flex-grow mx-4">
                        <h3 class="text-lg font-semibold text-gray-300 truncate">{{ item.name }}</h3>
                        <p class="text-lg font-bold text-gray-300">${{ item.price }}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <!-- Minus Button -->
                        <button class="bg-gray-700 text-white p-2 rounded-lg hover:bg-gray-800 minus-btn" data-id="{{ item.id }}">
                            <i class="fi fi-rr-minus-circle"></i>
                        </button>
                        <span class="text-lg font-semibold">{{ item.quantity }}</span>
                        <!-- Add Button -->
                        <button class="bg-gray-700 text-white p-2 rounded-lg hover:bg-gray-800 add-btn" data-id="{{ item.id }}">
                            <i class="fi fi-rr-add"></i>
                        </button>
                        <!-- Trash Button -->
                        <button class="bg-red-500 px-2 py-1 rounded-sm text-xl ml-2 hover:bg-red-600 trash-btn" data-id="{{ item.id }}">
                            <i class="fi fi-rr-trash"></i>
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Order Summary -->
            <div class="w-full lg:w-2/5 bg-white bg-opacity-20 backdrop-blur-lg shadow-md rounded-lg p-6 flex flex-col max-h-[25rem] lg:max-h-[25rem] lg:justify-center overflow-hidden">
                <h1 class="text-3xl font-bold text-gray-200">Order Summary</h1>
                <p class="text-sm text-gray-300 mt-2">Items: {{ total_items }}</p>
                <p class="text-sm text-gray-300 mt-2">Subtotal: ${{ subtotal|floatformat:2 }}</p>
                <p class="text-sm text-gray-300 mt-2">Tax: ${{ tax_amount|floatformat:2 }}</p>
                <h3 class="text-xl font-semibold text-gray-200 mt-4">Grand Total: ${{ total_amount|floatformat:2 }}</h3>

                <div class="mt-6 flex flex-col space-y-4">
                    <button class="clear_cart bg-red-500 px-3 py-2 text-white rounded-md w-full text-xs flex justify-between items-center hover:bg-red-600 z-50">
                        <span>Clear Cart</span>
                        <i class="fi fi-rr-trash"></i>
                    </button>
                    <button class="bg-yellow-500 px-2 py-1 rounded-sm text-xl flex justify-between items-center text-white hover:bg-yellow-600 z-50">
                        <span>Proceed to Checkout</span>
                        <i class="fi fi-rr-credit-card"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
  
    .cart-items {
        overflow: auto;
    }

    .cart-items::-webkit-scrollbar {
        display: none;
    }

    .cart-items {
        -ms-overflow-style: none; 
        scrollbar-width: none; 
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
     
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                let date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        
        function getCookie(name) {
            let nameEQ = name + "=";
            let ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

       
        function clearCookie(name) {
            setCookie(name, "", -1);
        }

        // Function to update cart badge
        function updateCartBadge() {
            let cart = JSON.parse(getCookie('cart')) || {};
            let totalQuantity = Object.values(cart).reduce((acc, quantity) => acc + quantity, 0);
            let badgeElement = document.getElementById('cart-badge');
            if (badgeElement) {
                badgeElement.textContent = totalQuantity;
            }
        }

        updateCartBadge();

        // Function to update cart item quantity
        function updateCart(plantId, change) {
            let cart = JSON.parse(getCookie('cart')) || {};
            if (cart[plantId]) {
                cart[plantId] += change;
                if (cart[plantId] <= 0) {
                    delete cart[plantId];  
                }
            } else if (change > 0) {
                cart[plantId] = 1;  
            }
            setCookie('cart', JSON.stringify(cart), 7);  
            updateCartBadge(); 
            location.reload();  
        }

        
        document.querySelectorAll('.add-btn').forEach(button => {
            button.addEventListener('click', function () {
                const plantId = this.getAttribute('data-id');
                updateCart(plantId, 1); 
            });
        });

        document.querySelectorAll('.minus-btn').forEach(button => {
            button.addEventListener('click', function () {
                const plantId = this.getAttribute('data-id');
                updateCart(plantId, -1); 
            });
        });

        document.querySelectorAll('.trash-btn').forEach(button => {
            button.addEventListener('click', function () {
                const plantId = this.getAttribute('data-id');
                updateCart(plantId, -100); 
            });
        });

      
        document.querySelector('.clear_cart').addEventListener('click', function () {
            clearCookie('cart'); 
            updateCartBadge(); 
            location.reload();
        });
    });
</script>

{% endblock %}
